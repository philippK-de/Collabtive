!function(){var w=tinymce.util.Tools.resolve("tinymce.PluginManager"),x=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),y=tinymce.util.Tools.resolve("tinymce.EditorManager"),z=tinymce.util.Tools.resolve("tinymce.Env"),e=tinymce.util.Tools.resolve("tinymce.util.Tools"),r=function(a){return a.getParam("importcss_selector_converter")},A=function(a){var b=z.cacheSuffix;return"string"==typeof a&&(a=a.replace("?"+b,"").replace("&"+b,"")),a},B=function(a,b){var c=a.settings,e=!1!==c.skin&&(c.skin||"lightgray");
return!!e&&b===(c.skin_url?a.documentBaseURI.toAbsolute(c.skin_url):y.baseURL+"/skins/"+e)+"/content"+(a.inline?".inline":"")+".min.css"},q=function(a){return"string"==typeof a?function(b){return-1!==b.indexOf(a)}:a instanceof RegExp?function(b){return a.test(b)}:a},C=function(a,b,c){var g=[],d={};e.each(a.contentCSS,function(a){d[a]=!0});c||(c=function(a,b){return b||d[a]});try{e.each(b.styleSheets,function(b){!function l(b,d){var m,f=b.href;if((f=A(f))&&c(f,d)&&!B(a,f)){e.each(b.imports,function(a){l(a,
!0)});try{m=b.cssRules||b.rules}catch(F){}e.each(m,function(a){a.styleSheet?l(a.styleSheet,!0):a.selectorText&&e.each(a.selectorText.split(","),function(a){g.push(e.trim(a))})})}}(b)})}catch(h){}return g},u=function(a,b){var c,g=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(b);if(g){var d=g[1],h=g[2].substr(1).split(".").join(" "),k=e.makeMap("a,img");return g[1]?(c={title:b},a.schema.getTextBlockElements()[d]?c.block=d:a.schema.getBlockElements()[d]||k[d.toLowerCase()]?c.selector=d:c.inline=d):
g[2]&&(c={inline:"span",title:b.substr(1),classes:h}),!1!==a.getParam("importcss_merge_classes")?c.classes=h:c.attributes={"class":h},c}},v=function(a,b){return null===b||!1!==a.getParam("importcss_exclusive")},D=function(a){a.on("renderFormatsMenu",function(b){var c,g={},d=q(a.getParam("importcss_selector_filter")),h=b.control,k=(c=a.getParam("importcss_groups"),e.map(c,function(a){return e.extend({},a,{original:a,selectors:{},filter:q(a.filter),item:{text:a.title,menu:[]}})})),l=function(b,c){if(n=
b,t=g,!(v(a,k=c)?n in t:n in k.selectors))if(n=b,k=g,v(a,l=c)?k[n]=!0:l.selectors[n]=!0,b=(d=a,f=a.plugins.importcss,m=b,((p=c)&&p.selector_converter?p.selector_converter:r(d)?r(d):function(){return u(d,m)}).call(f,m,p)))return f=b.name||x.DOM.uniqueId(),a.formatter.register(f,b),e.extend({},h.settings.itemDefaults,{text:b.title,format:f});var d,f,m,p,l,n,k,t;return null};a.getParam("importcss_append")||h.items().remove();e.each(C(a,b.doc||a.getDoc(),q(a.getParam("importcss_file_filter"))),function(a){if(-1===
a.indexOf(".mce-")&&(!d||d(a))){var b=(c=k,f=a,e.grep(c,function(a){return!a.filter||a.filter(f)}));0<b.length?e.each(b,function(b){var c=l(a,b);c&&b.item.menu.push(c)}):(b=l(a,null))&&h.add(b)}var c,f});e.each(k,function(a){0<a.item.menu.length&&h.add(a.item)});b.control.renderNew()})},E=function(a){return{convertSelectorToFormat:function(b){return u(a,b)}}};w.add("importcss",function(a){return D(a),E(a)})}();

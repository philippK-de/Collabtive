!function(){var q=function(a){var b=a;return{get:function(){return b},set:function(a){b=a},clone:function(){return q(b)}}},x=tinymce.util.Tools.resolve("tinymce.PluginManager"),y=function(a){return{setPatterns:function(b){a.set(b)},getPatterns:function(){return a.get()}}},z=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",
format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],A=tinymce.util.Tools.resolve("tinymce.util.Delay"),r=tinymce.util.Tools.resolve("tinymce.util.VK"),B=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),n=tinymce.util.Tools.resolve("tinymce.util.Tools"),t=function(a,b){for(var c=0;c<a.length;c++)if(0===b.indexOf(a[c].start)&&(!a[c].end||b.lastIndexOf(a[c].end)===b.length-a[c].end.length))return a[c]},
C=function(a,b,c,d){var f,e,g,l,h,m=a.sort(function(a,c){return a.start.length>c.start.length?-1:a.start.length<c.start.length?1:0});for(a=0;a<m.length;a++)if(void 0!==(f=m[a]).end&&(g=f,l=c,h=d,b.substr(l-g.end.length-h,g.end.length)===g.end)&&0<c-d-(e=f).end.length-e.start.length)return f},u=function(a,b,c){if(!1!==b.collapsed){var d=b.startContainer,f=d.data,e=!0===c?1:0;if(3===d.nodeType&&(c=C(a,f,b.startOffset,e),void 0!==c&&(b=f.lastIndexOf(c.end,b.startOffset-e),e=f.lastIndexOf(c.start,b-c.end.length),
b=f.indexOf(c.end,e+c.start.length),-1!==e))&&(f=document.createRange(),f.setStart(d,e),f.setEnd(d,b+c.end.length),a=t(a,f.toString()),!(void 0===c||a!==c||d.data.length<=c.start.length+c.end.length)))return{pattern:c,startOffset:e,endOffset:b}}},v=function(a,b,c){var d=a.selection.getRng(!0);if(b=u(b,d,c))return function(a,c,b,d){var f=n.isArray(b.pattern.format)?b.pattern.format:[b.pattern.format];if(0!==n.grep(f,function(c){return(c=a.formatter.get(c))&&c[0].inline}).length)return a.undoManager.transact(function(){var d,
e,h,g;d=c;e=b.pattern;h=b.endOffset;g=b.startOffset;(d=0<g?d.splitText(g):d).splitText(h-g+e.end.length);d.deleteData(0,e.start.length);d.deleteData(d.data.length-e.end.length,e.end.length);c=d;f.forEach(function(b){a.formatter.apply(b,{},c)})}),c}(a,d.startContainer,b)},p={patternFromRng:u,applyInlineFormatSpace:function(a,b){return v(a,b,!0)},applyInlineFormatEnter:function(a,b){return v(a,b,!1)},applyBlockFormat:function(a,b){var c,d,f,e,g,l,h,m,k;if(c=a.selection,d=a.dom,c.isCollapsed()&&(l=d.getParent(c.getStart(),
"p"))){for(l=new B(l,l);d=l.next();)if(3===d.nodeType){e=d;break}e&&(h=t(b,e.data))&&(f=(m=c.getRng(!0)).startContainer,k=m.startOffset,e===f&&(k=Math.max(0,k-h.start.length)),n.trim(e.data).length!==h.start.length)&&(h.format&&(g=a.formatter.get(h.format))&&g[0].block&&(e.deleteData(0,h.start.length),a.formatter.apply(h.format,{},e),m.setStart(f,k),m.collapse(!0),c.setRng(m)),h.cmd&&a.undoManager.transact(function(){e.deleteData(0,h.start.length);a.execCommand(h.cmd)}))}}},w=function(a,b,c){for(var d=
0;d<a.length;d++)if(c(a[d],b))return!0},k={handleEnter:function(a,b){var c,d;(c=p.applyInlineFormatEnter(a,b))&&((d=a.dom.createRng()).setStart(c,c.data.length),d.setEnd(c,c.data.length),a.selection.setRng(d));p.applyBlockFormat(a,b)},handleInlineKey:function(a,b){var c,d,f,e,g;(c=p.applyInlineFormatSpace(a,b))&&(g=a.dom,d=c.data.slice(-1),/[\u00a0 ]/.test(d)&&(c.deleteData(c.data.length-1,1),f=g.doc.createTextNode(d),g.insertAfter(f,c.parentNode),(e=g.createRng()).setStart(f,1),e.setEnd(f,1),a.selection.setRng(e)))},
checkCharCode:function(a,b){return w(a,b,function(a,b){return a.charCodeAt(0)===b.charCode})},checkKeyCode:function(a,b){return w(a,b,function(a,b){return a===b.keyCode&&!1===r.modifierPressed(b)})}},D=function(a,b){var c=",.;:!?".split(""),d=[32];a.on("keydown",function(c){13!==c.keyCode||r.modifierPressed(c)||k.handleEnter(a,b.get())},!0);a.on("keyup",function(c){k.checkKeyCode(d,c)&&k.handleInlineKey(a,b.get())});a.on("keypress",function(d){k.checkCharCode(c,d)&&A.setEditorTimeout(a,function(){k.handleInlineKey(a,
b.get())})})};x.add("textpattern",function(a){var b=a.settings,b=q(void 0!==b.textpattern_patterns?b.textpattern_patterns:z);return D(a,b),y(b)})}();

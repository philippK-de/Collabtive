var $jscomp={scope:{},findInternal:function(f,q,g){f instanceof String&&(f=String(f));for(var r=f.length,n=0;n<r;n++){var k=f[n];if(q.call(g,k,n,f))return{i:n,v:k}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(f,q,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");f!=Array.prototype&&f!=Object.prototype&&(f[q]=g.value)};
$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(f,q,g,r){if(q){g=$jscomp.global;f=f.split(".");for(r=0;r<f.length-1;r++){var n=f[r];n in g||(g[n]={});g=g[n]}f=f[f.length-1];r=g[f];q=q(r);q!=r&&null!=q&&$jscomp.defineProperty(g,f,{configurable:!0,writable:!0,value:q})}};
$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(f,g){return $jscomp.findInternal(this,f,g).v}},"es6-impl","es3");
!function(){function f(){return new (u.getOrDie("FileReader"))}function q(a){var b=function(b,d,t,m){var c,e;(c=new function(){return new (u.getOrDie("XMLHttpRequest"))}).open("POST",a.url);c.withCredentials=a.credentials;c.upload.onprogress=function(a){m(a.loaded/a.total*100)};c.onerror=function(){t("Image upload failed due to a XHR Transport error. Code: "+c.status)};c.onload=function(){var b;if(200>c.status||300<=c.status)t("HTTP Error: "+c.status);else if((b=JSON.parse(c.responseText))&&"string"==
typeof b.location){var e;e=a.basePath;b=b.location;e=e?e.replace(/\/$/,"")+"/"+b.replace(/^\//,""):b;d(e)}else t("Invalid JSON: "+c.responseText)};(e=new FormData).append("file",b.blob(),b.filename());c.send(e)};return a=n.extend({credentials:!1,handler:b},a),{upload:function(e){return a.url||a.handler!==b?(d=e,t=a.handler,new w(function(a,c){try{t(d,a,c,G)}catch(F){c(F.message)}})):w.reject("Upload url missing from the settings.");var d,t}}}function g(a){function b(b){function d(){var b,d;v.updateSize(m);
e(a,m);(h=n.extend(h,m.toJSON())).alt||(h.alt="");h.title||(h.title="");""===h.width&&(h.width=null);""===h.height&&(h.height=null);h.style||(h.style=null);h={src:h.src,alt:h.alt,title:h.title,width:h.width,height:h.height,style:h.style,caption:h.caption,"class":h["class"]};a.undoManager.transact(function(){if(h.src)if(""===h.title&&(h.title=null),c?l.setAttribs(c,h):(h.id="__mcenew",a.focus(),a.selection.setContent(l.createHTML("img",h)),c=l.get("__mcenew"),l.setAttrib(c,"id",null)),a.editorUpload.uploadImagesAuto(),
!1===h.caption&&l.is(c.parentNode,"figure.image")&&(b=c.parentNode,l.insertAfter(c,b),l.remove(b)),!0!==h.caption)p.waitLoadImage(a,h,c);else{if(!l.is(c.parentNode,"figure.image")){d=c;c=c.cloneNode(!0);(b=l.create("figure",{"class":"image"})).appendChild(c);b.appendChild(l.create("figcaption",{contentEditable:!0},"Caption"));b.contentEditable=!1;var e=l.getParent(d,function(b){return a.schema.getTextBlockElements()[b.nodeName]});e?l.split(e,d,b):l.replace(b,d);a.selection.select(b)}}else c&&(e=l.is(c.parentNode,
"figure.image")?c.parentNode:c,l.remove(e),a.focus(),a.nodeChanged(),l.isEmpty(a.getBody())&&(a.setContent(""),a.selection.setCursorLocation()))})}var m,c,f,g,h={},l=a.dom;(c=a.selection.getNode(),(f=l.getParent(c,"figure.image"))&&(c=l.select("img",f)[0]),c&&("IMG"!==c.nodeName||c.getAttribute("data-mce-object")||c.getAttribute("data-mce-placeholder"))&&(c=null),c&&(h={src:l.getAttrib(c,"src"),alt:l.getAttrib(c,"alt"),title:l.getAttrib(c,"title"),"class":l.getAttrib(c,"class"),width:l.getAttrib(c,
"width"),height:l.getAttrib(c,"height"),caption:!!f}),b&&(g={type:"listbox",label:"Image list",name:"image-list",values:p.buildListItems(b,function(b){b.value=a.convertURL(b.value||b.url,"src")},[{text:"None",value:""}]),value:h.src&&a.convertURL(h.src,"src"),onselect:function(a){var b=m.find("#alt");(!b.value()||a.lastControl&&b.value()===a.lastControl.text())&&b.value(a.control.text());m.find("#src").value(a.control.value()).fire("change")},onPostRender:function(){g=this}}),k.hasAdvTab(a)||k.hasUploadUrl(a)||
k.hasUploadHandler(a))?(b=[x.makeTab(a,g)],k.hasAdvTab(a)&&(c&&(c.style.marginLeft&&c.style.marginRight&&c.style.marginLeft===c.style.marginRight&&(h.hspace=p.removePixelSuffix(c.style.marginLeft)),c.style.marginTop&&c.style.marginBottom&&c.style.marginTop===c.style.marginBottom&&(h.vspace=p.removePixelSuffix(c.style.marginTop)),c.style.borderWidth&&(h.border=p.removePixelSuffix(c.style.borderWidth)),h.borderStyle=c.style.borderStyle,h.style=a.dom.serializeStyle(a.dom.parseStyle(a.dom.getAttrib(c,
"style")))),b.push(H.makeTab(a,e))),(k.hasUploadUrl(a)||k.hasUploadHandler(a))&&b.push(I.makeTab(a)),m=a.windowManager.open({title:"Insert/edit image",data:h,bodyType:"tabpanel",body:b,onSubmit:d})):m=a.windowManager.open({title:"Insert/edit image",data:h,body:x.getGeneralItems(a,g),onSubmit:d});v.syncSize(m)}var e=function(a,b){if(k.hasAdvTab(a)){a=a.dom;var d=b.toJSON(),c=a.parseStyle(d.style),c=p.mergeMargins(c);d.vspace&&(c["margin-top"]=c["margin-bottom"]=p.addPixelSuffix(d.vspace));d.hspace&&
(c["margin-left"]=c["margin-right"]=p.addPixelSuffix(d.hspace));d.border&&(c["border-width"]=p.addPixelSuffix(d.border));d.borderStyle&&(c["border-style"]=d.borderStyle);b.find("#style").value(a.serializeStyle(a.parseStyle(a.serializeStyle(c))))}};return{open:function(){p.createImageList(a,b)}}}var r=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.util.Tools"),k={hasDimensions:function(a){return!1!==a.settings.image_dimensions},hasAdvTab:function(a){return!0===
a.settings.image_advtab},getPrependUrl:function(a){return a.getParam("image_prepend_url","")},getClassList:function(a){return a.getParam("image_class_list")},hasDescription:function(a){return!1!==a.settings.image_description},hasImageTitle:function(a){return!0===a.settings.image_title},hasImageCaption:function(a){return!0===a.settings.image_caption},getImageList:function(a){return a.getParam("image_list",!1)},hasUploadUrl:function(a){return a.getParam("images_upload_url",!1)},hasUploadHandler:function(a){return a.getParam("images_upload_handler",
!1)},getUploadUrl:function(a){return a.getParam("images_upload_url")},getUploadHandler:function(a){return a.getParam("images_upload_handler")},getUploadBasePath:function(a){return a.getParam("images_upload_base_path")},getUploadCredentials:function(a){return a.getParam("images_upload_credentials")}},J="undefined"!=typeof window?window:Function("return this;")(),u={getOrDie:function(a,b){var e;e=a.split(".");b=void 0!==b&&null!==b?b:J;for(var d=0;d<e.length&&void 0!==b&&null!==b;++d)b=b[e[d]];e=b;
if(void 0===e||null===e)throw a+" not available on this browser";return e}},w=tinymce.util.Tools.resolve("tinymce.util.Promise"),K=tinymce.util.Tools.resolve("tinymce.util.XHR"),y=function(a,b){return Math.max(parseInt(a,10),parseInt(b,10))},p={getImageSize:function(a,b){function e(a,c){d.parentNode&&d.parentNode.removeChild(d);b({width:a,height:c})}var d=document.createElement("img");d.onload=function(){e(y(d.width,d.clientWidth),y(d.height,d.clientHeight))};d.onerror=function(){e(0,0)};var f=d.style;
f.visibility="hidden";f.position="fixed";f.bottom=f.left="0px";f.width=f.height="auto";document.body.appendChild(d);d.src=a},buildListItems:function(a,b,e){return function t(a,c){return c=c||[],n.each(a,function(a){var e={text:a.text||a.title};a.menu?e.menu=t(a.menu):(e.value=a.value,b(e));c.push(e)}),c}(a,e||[])},removePixelSuffix:function(a){return a&&(a=a.replace(/px$/,"")),a},addPixelSuffix:function(a){return 0<a.length&&/^[0-9]+$/.test(a)&&(a+="px"),a},mergeMargins:function(a){if(a.margin){var b=
a.margin.split(" ");switch(b.length){case 1:a["margin-top"]=a["margin-top"]||b[0];a["margin-right"]=a["margin-right"]||b[0];a["margin-bottom"]=a["margin-bottom"]||b[0];a["margin-left"]=a["margin-left"]||b[0];break;case 2:a["margin-top"]=a["margin-top"]||b[0];a["margin-right"]=a["margin-right"]||b[1];a["margin-bottom"]=a["margin-bottom"]||b[0];a["margin-left"]=a["margin-left"]||b[1];break;case 3:a["margin-top"]=a["margin-top"]||b[0];a["margin-right"]=a["margin-right"]||b[1];a["margin-bottom"]=a["margin-bottom"]||
b[2];a["margin-left"]=a["margin-left"]||b[1];break;case 4:a["margin-top"]=a["margin-top"]||b[0],a["margin-right"]=a["margin-right"]||b[1],a["margin-bottom"]=a["margin-bottom"]||b[2],a["margin-left"]=a["margin-left"]||b[3]}delete a.margin}return a},createImageList:function(a,b){a=k.getImageList(a);"string"==typeof a?K.send({url:a,success:function(a){b(JSON.parse(a))}}):"function"==typeof a?a(b):b(a)},waitLoadImage:function(a,b,e){function d(){e.onload=e.onerror=null;a.selection&&(a.selection.select(e),
a.nodeChanged())}e.onload=function(){b.width||b.height||!k.hasDimensions(a)||a.dom.setAttribs(e,{width:e.clientWidth,height:e.clientHeight});d()};e.onerror=d},blobToDataUri:function(a){return new w(function(b,e){var d=new f;d.onload=function(){b(d.result)};d.onerror=function(){e(f.error.message)};d.readAsDataURL(a)})}},H={makeTab:function(a,b){return{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:(e=a,function(a){var b=e.dom;a=a.control.rootControl;
if(k.hasAdvTab(e)){var d=a.toJSON(),d=b.parseStyle(d.style);a.find("#vspace").value("");a.find("#hspace").value("");((d=p.mergeMargins(d))["margin-top"]&&d["margin-bottom"]||d["margin-right"]&&d["margin-left"])&&(d["margin-top"]===d["margin-bottom"]?a.find("#vspace").value(p.removePixelSuffix(d["margin-top"])):a.find("#vspace").value(""),d["margin-right"]===d["margin-left"]?a.find("#hspace").value(p.removePixelSuffix(d["margin-right"])):a.find("#hspace").value(""));d["border-width"]&&a.find("#border").value(p.removePixelSuffix(d["border-width"]));
a.find("#style").value(b.serializeStyle(b.parseStyle(b.serializeStyle(d))))}})},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,defaults:{type:"textbox",maxWidth:50,onchange:function(d){b(a,d.control.rootControl)}},items:[{label:"Vertical space",name:"vspace"},{label:"Border width",name:"border"},{label:"Horizontal space",name:"hspace"},{label:"Border style",type:"listbox",name:"borderStyle",width:90,maxWidth:90,onselect:function(d){b(a,d.control.rootControl)},values:[{text:"Select...",
value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]};var e}},z=function(a,b){a.state.set("oldVal",a.value());b.state.set("oldVal",b.value())},A=function(a,b){var e=a.find("#width")[0],d=a.find("#height")[0];a=a.find("#constrain")[0];e&&d&&
a&&b(e,d,a.checked())},L=function(a,b,e){var d=a.state.get("oldVal"),f=b.state.get("oldVal"),m=a.value(),c=b.value();e&&d&&f&&m&&c&&(m!==d?(c=Math.round(m/d*c),isNaN(c)||b.value(c)):(m=Math.round(c/f*m),isNaN(m)||a.value(m)));z(a,b)},B=function(a){A(a,L)},v={createUi:function(){var a=function(a){B(a.control.rootControl)};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Width"},{type:"label",
text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:a,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}},syncSize:function(a){A(a,z)},updateSize:B},M=function(a){a.meta=a.control.rootControl.toJSON()},C=function(a,b){b=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(b){var d,e,f,c,g,q;c=b.meta||{};b=b.control;g=b.rootControl;(q=g.find("#image-list")[0])&&q.value(a.convertURL(b.value(),"src"));
n.each(c,function(a,b){g.find("#"+b).value(a)});c.width||c.height||(d=a.convertURL(b.value(),"src"),e=k.getPrependUrl(a),f=/^(?:[a-z]+:)?\/\//i,e&&!f.test(d)&&d.substring(0,e.length)!==e&&(d=e+d),b.value(d),p.getImageSize(a.documentBaseURI.toAbsolute(b.value()),function(b){b.width&&b.height&&k.hasDimensions(a)&&(g.find("#width").value(b.width),g.find("#height").value(b.height),v.updateSize(g))}))},onbeforecall:M},b];return k.hasDescription(a)&&b.push({name:"alt",type:"textbox",label:"Image description"}),
k.hasImageTitle(a)&&b.push({name:"title",type:"textbox",label:"Image Title"}),k.hasDimensions(a)&&b.push(v.createUi()),k.getClassList(a)&&b.push({name:"class",type:"listbox",label:"Class",values:p.buildListItems(k.getClassList(a),function(b){b.value&&(b.textStyle=function(){return a.formatter.getCssText({inline:"img",classes:[b.value]})})})}),k.hasImageCaption(a)&&b.push({name:"caption",type:"checkbox",label:"Caption"}),b},x={makeTab:function(a,b){return{title:"General",type:"form",items:C(a,b)}},
getGeneralItems:C},N=function(a){return u.getOrDie("URL").createObjectURL(a)},O=tinymce.util.Tools.resolve("tinymce.ui.Factory"),G=function(){},D=function(a){return function(b){var e=O.get("Throbber"),d=b.control.rootControl,f=new e(d.getEl()),g=b.control.value(),c=N(g),n=q({url:k.getUploadUrl(a),basePath:k.getUploadBasePath(a),credentials:k.getUploadCredentials(a),handler:k.getUploadHandler(a)});return f.show(),p.blobToDataUri(g).then(function(b){b=a.editorUpload.blobCache.create({blob:g,blobUri:c,
name:g.name?g.name.replace(/\.[^\.]+$/,""):null,base64:b.split(",")[1]});return n.upload(b).then(function(a){var b=d.find("#src");b.value(a);d.find("tabpanel")[0].activateTab(0);b.fire("change");f.hide();u.getOrDie("URL").revokeObjectURL(c);return a})})["catch"](function(b){a.windowManager.alert(b);f.hide();u.getOrDie("URL").revokeObjectURL(c)})}},I={makeTab:function(a){return{title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",
layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:".jpg,.jpeg,.png,.gif",onchange:D(a)},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:".jpg,.jpeg,.png,.gif",height:100,onchange:D(a)}]}}},E=function(a){return function(b){for(var e,d,f=b.length,g=function(b){b.attr("contenteditable",a?"true":null)};f--;)e=b[f],(d=e.attr("class"))&&/\bimage\b/.test(d)&&(e.attr("contenteditable",a?"false":null),n.each(e.getAll("figcaption"),
g))}},P=function(a){a.on("preInit",function(){a.parser.addNodeFilter("figure",E(!0));a.serializer.addNodeFilter("figure",E(!1))})};r.add("image",function(a){P(a);a.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:g(a).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"});a.addMenuItem("image",{icon:"image",text:"Image",onclick:g(a).open,context:"insert",prependToContext:!0});a.addCommand("mceImage",g(a).open)})}();

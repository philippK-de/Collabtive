!function(){var p=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.Env"),m=function(a,b){if(0>b&&(b=0),3===a.nodeType)a=a.data.length,b>a&&(b=a);return b},k=function(a,b,g){1!==b.nodeType||b.hasChildNodes()?a.setStart(b,m(b,g)):a.setStartBefore(b)},h=function(a,b,g){1!==b.nodeType||b.hasChildNodes()?a.setEnd(b,m(b,g)):a.setEndAfter(b)},l=function(a,b,g){var c,e,d,l,m,f,n,p=a.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i),
r=a.getParam("default_link_target","");if("A"!==a.selection.getNode().tagName){if(5>(c=a.selection.getRng(!0).cloneRange()).startOffset){if(!(d=c.endContainer.previousSibling)){if(!c.endContainer.firstChild||!c.endContainer.firstChild.nextSibling)return;d=c.endContainer.firstChild.nextSibling}if(e=d.length,k(c,d,e),h(c,d,e),5>c.endOffset)return;e=c.endOffset}else{if(3!==(d=c.endContainer).nodeType&&d.firstChild){for(;3!==d.nodeType&&d.firstChild;)d=d.firstChild;3===d.nodeType&&(k(c,d,0),h(c,d,d.nodeValue.length))}e=
1===c.endOffset?2:c.endOffset-1-b}for(b=e;k(c,d,2<=e?e-2:0),h(c,d,1<=e?e-1:0),--e," "!==(n=c.toString())&&""!==n&&160!==n.charCodeAt(0)&&0<=e-2&&n!==g;);var q;(q=c.toString())===g||" "===q||160===q.charCodeAt(0)?(k(c,d,e),h(c,d,b)):0===c.startOffset?(k(c,d,0),h(c,d,b)):(k(c,d,e),h(c,d,b));"."===(m=c.toString()).charAt(m.length-1)&&h(c,d,b-1);(f=c.toString().trim().match(p))&&("www."===f[1]?f[1]="http://www.":/@$/.test(f[1])&&!/^mailto:/.test(f[1])&&(f[1]="mailto:"+f[1]),l=a.selection.getBookmark(),
a.selection.setRng(c),a.execCommand("createlink",!1,f[1]+f[2]),r&&a.dom.setAttrib(a.selection.getNode(),"target",r),a.selection.moveToBookmark(l),a.nodeChanged())}},u=function(a){var b;a.on("keydown",function(b){13!==b.keyCode||l(a,-1,"")});t.ie?a.on("focus",function(){if(!b){b=!0;try{a.execCommand("AutoUrlDetect",!1,!0)}catch(g){}}}):(a.on("keypress",function(b){41!==b.keyCode||l(a,-1,"(")}),a.on("keyup",function(b){32!==b.keyCode||l(a,0,"")}))};p.add("autolink",function(a){u(a)})}();

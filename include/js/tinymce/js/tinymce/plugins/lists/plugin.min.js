!function(){var da=tinymce.util.Tools.resolve("tinymce.PluginManager"),N=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),ea=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),C=tinymce.util.Tools.resolve("tinymce.util.VK"),fa=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),l=tinymce.util.Tools.resolve("tinymce.util.Tools"),x=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),v=function(a){return a&&"BR"===a.nodeName},n=function(a){return a&&/^(OL|UL|DL)$/.test(a.nodeName)},D=function(a,
b){return b&&!!a.schema.getTextBlockElements()[b.nodeName]},q=function(a,b,c){var e=a.isEmpty(b);return!(c&&0<a.select("span[data-mce-type=bookmark]",b).length)&&e},O=function(a,b){var c=N.getNode(a,b);return a&&/^(LI|DT|DD)$/.test(a.nodeName)&&c&&3===c.nodeType?{container:c,offset:b>=a.childNodes.length?c.data.length:0}:{container:a,offset:b}},E=function(a){var b=a.cloneRange(),c=O(a.startContainer,a.startOffset);b.setStart(c.container,c.offset);a=O(a.endContainer,a.endOffset);return b.setEnd(a.container,
a.offset),b},y=x.DOM,r=function(a){var b={},c=function(c){var d,e,f;e=a[c?"startContainer":"endContainer"];f=a[c?"startOffset":"endOffset"];1===e.nodeType&&(d=y.create("span",{"data-mce-type":"bookmark"}),e.hasChildNodes()?(f=Math.min(f,e.childNodes.length-1),c?e.insertBefore(d,e.childNodes[f]):y.insertAfter(d,e.childNodes[f])):e.appendChild(d),e=d,f=0);b[c?"startContainer":"endContainer"]=e;b[c?"startOffset":"endOffset"]=f};return c(!0),a.collapsed||c(),b},t=function(a){function b(b){var c,e,f;c=
f=a[b?"startContainer":"endContainer"];e=a[b?"startOffset":"endOffset"];if(c){if(1===c.nodeType){a:{e=c;for(var h=e.parentNode.firstChild,k=0;h;){if(h===e){e=k;break a}1===h.nodeType&&"bookmark"===h.getAttribute("data-mce-type")||k++;h=h.nextSibling}e=-1}c=c.parentNode;y.remove(f);!c.hasChildNodes()&&y.isBlock(c)&&c.appendChild(y.create("br"))}a[b?"startContainer":"endContainer"]=c;a[b?"startOffset":"endOffset"]=e}}b(!0);b();var c=y.createRng();return c.setStart(a.startContainer,a.startOffset),a.endContainer&&
c.setEnd(a.endContainer,a.endOffset),E(c)},P=x.DOM,F=function(a,b){l.each(l.grep(a.select("ol,ul",b)),function(b){var c,d=b.parentNode;"LI"===d.nodeName&&d.firstChild===b&&((c=d.previousSibling)&&"LI"===c.nodeName?(c.appendChild(b),q(a,d)&&P.remove(d)):P.setStyle(d,"listStyleType","none"));n(d)&&(c=d.previousSibling)&&"LI"===c.nodeName&&c.appendChild(b)})},ga=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),Q=function(a){var b=a.selection.getStart(!0);return a.dom.getParent(b,"OL,UL,DL",G(a,b))},
G=function(a,b){b=a.dom.getParents(b,"TD,TH");return 0<b.length?b[0]:a.getBody()},p={getParentList:Q,getSelectedSubLists:function(a){var b=Q(a);a=a.selection.getSelectedBlocks();return b&&1===a.length&&a[0]===b?l.grep(b.querySelectorAll("ol,ul,dl"),function(a){return n(a)}):l.grep(a,function(a){return n(a)&&b!==a})},getSelectedListItems:function(a){var b,c=a.selection.getSelectedBlocks();return l.grep((b=l.map(c,function(b){return a.dom.getParent(b,"li,dd,dt",G(a,b))||b}),ga.unique(b)),function(a){return a&&
/^(LI|DT|DD)$/.test(a.nodeName)})},getClosestListRootElm:G},R=tinymce.util.Tools.resolve("tinymce.Env"),z=x.DOM,w=function(a,b,c){var e,d,g,f=z.createFragment(),h=a.schema.getBlockElements();a.settings.forced_root_block&&(c=c||a.settings.forced_root_block);c&&((d=z.create(c)).tagName===a.settings.forced_root_block&&z.setAttribs(d,a.settings.forced_root_block_attrs),(e=b.firstChild)&&e.nodeName in h||f.appendChild(d));if(b)for(;e=b.firstChild;){var k=e.nodeName;g||"SPAN"===k&&"bookmark"===e.getAttribute("data-mce-type")||
(g=!0);e&&e.nodeName in h?(f.appendChild(e),d=null):c?(d||(d=z.create(c),f.appendChild(d)),d.appendChild(e)):f.appendChild(e)}return a.settings.forced_root_block?g||R.ie&&!(10<R.ie)||d.appendChild(z.create("br",{"data-mce-bogus":"1"})):f.appendChild(z.create("br")),f},u=x.DOM,S=function(a,b,c,e){var d,g,f,h;g=u.select('span[data-mce-type="bookmark"]',b);e=e||w(a,c);(d=u.createRng()).setStartAfter(c);d.setEndAfter(b);for(f=(d=d.extractContents()).firstChild;f;f=f.firstChild)if("LI"===f.nodeName&&a.dom.isEmpty(f)){u.remove(f);
break}a.dom.isEmpty(d)||u.insertAfter(d,b);u.insertAfter(e,b);q(a.dom,c.parentNode)&&(h=c.parentNode,l.each(g,function(a){h.parentNode.insertBefore(a,c.parentNode)}),u.remove(h));u.remove(c);q(a.dom,b)&&u.remove(b)},m=x.DOM,T=function(a,b){var c,e=b.parentNode,d=e.parentNode,g;if(g=e!==a.getBody())"DD"===b.nodeName?c=(m.rename(b,"DT"),0):b.parentNode.firstChild===b&&b.parentNode.lastChild===b?("LI"===d.nodeName?(m.insertAfter(b,d),q(a.dom,d)&&m.remove(d),m.remove(e)):n(d)?m.remove(e,!0):(d.insertBefore(w(a,
b),e),m.remove(e)),c=0):(b.parentNode.firstChild===b?("LI"===d.nodeName?(m.insertAfter(b,d),b.appendChild(e),q(a.dom,d)&&m.remove(d)):n(d)?d.insertBefore(b,e):(d.insertBefore(w(a,b),e),m.remove(b)),a=0):a=b.parentNode.lastChild===b?("LI"===d.nodeName?m.insertAfter(b,d):n(d)?m.insertAfter(b,e):(m.insertAfter(w(a,b),e),m.remove(b)),0):("LI"===d.nodeName?(e=d,c=w(a,b,"LI")):c=n(d)?w(a,b,"LI"):w(a,b),S(a,e,b,c),F(a.dom,e.parentNode),0),c=a),g=c;return!g},U=function(a){var b=p.getSelectedListItems(a);
if(b.length){var c=r(a.selection.getRng(!0)),e,d,g=p.getClosestListRootElm(a,a.selection.getStart(!0));for(e=b.length;e--;)for(var f=b[e].parentNode;f&&f!==g;){for(d=b.length;d--;)if(b[d]===f){b.splice(e,1);break}f=f.parentNode}for(e=0;e<b.length&&(T(a,b[e])||0!==e);e++);return a.selection.setRng(t(c)),a.nodeChanged(),!0}},V=function(a,b){l.each(b,function(b,e){a.setAttribute(e,b)})},H=function(a,b,c){a.setStyle(b,"list-style-type",c["list-style-type"]?c["list-style-type"]:null);V(b,c["list-attributes"]);
l.each(a.select("li",b),function(a){V(a,c["list-item-attributes"])})},W=function(a,b,c,e){var d;d=b[c?"startContainer":"endContainer"];b=b[c?"startOffset":"endOffset"];1===d.nodeType&&(d=d.childNodes[Math.min(b,d.childNodes.length-1)]||d);for(!c&&v(d.nextSibling)&&(d=d.nextSibling);d.parentNode!==e&&!D(a,d)&&!/^(TD|TH)$/.test(d.parentNode.nodeName);)d=d.parentNode;return d},ha=function(a,b,c){void 0===c&&(c={});var e,d=a.selection.getRng(!0),g="LI",f=p.getClosestListRootElm(a,a.selection.getStart(!0)),
h=a.dom;"false"!==h.getContentEditable(a.selection.getNode())&&("DL"===(b=b.toUpperCase())&&(g="DT"),e=r(d),l.each(function(a,b,c){var d,e=[],f=a.dom,g=W(a,b,!0,c);b=W(a,b,!1,c);for(var h=[];g&&(h.push(g),g!==b);g=g.nextSibling);return l.each(h,function(b){if(D(a,b))return e.push(b),void(d=null);if(f.isBlock(b)||v(b))return v(b)&&f.remove(b),void(d=null);var g=b.nextSibling;fa.isBookmarkNode(b)&&(D(a,g)||!g&&b.parentNode===c)?d=null:(d||(d=f.create("p"),b.parentNode.insertBefore(d,b),e.push(d)),d.appendChild(b))}),
e}(a,d,f),function(d){var e,f,k,p,m,q;(f=d.previousSibling)&&n(f)&&f.nodeName===b&&(k=c,p=h.getStyle(f,"list-style-type"),m=k?k["list-style-type"]:"",p===(m=null===m?"":m))?(e=f,d=h.rename(d,g),f.appendChild(d)):(e=h.create(b),d.parentNode.insertBefore(e,d),e.appendChild(d),d=h.rename(d,g));q=d;l.each("margin margin-right margin-bottom margin-left margin-top padding padding-right padding-bottom padding-left padding-top".split(" "),function(a){return h.setStyle(q,((b={})[a]="",b));var b});H(h,e,c);
I(a.dom,e)}),a.selection.setRng(t(e)))},J=function(a){var b=r(a.selection.getRng(!0)),c=p.getClosestListRootElm(a,a.selection.getStart(!0)),e=p.getSelectedListItems(a),d=l.grep(e,function(b){return a.dom.isEmpty(b)}),e=l.grep(e,function(b){return!a.dom.isEmpty(b)});l.each(d,function(b){q(a.dom,b)&&T(a,b)});l.each(e,function(b){var d,e;if(b.parentNode!==a.getBody()){for(d=b;d&&d!==c;d=d.parentNode)n(d)&&(e=d);S(a,e,b);F(a.dom,e.parentNode)}});a.selection.setRng(t(b))},X=function(a,b,c){return k=c,
(h=b)&&k&&n(h)&&h.nodeName===k.nodeName&&(g=b,f=c,(d=a).getStyle(g,"list-style-type",!0)===d.getStyle(f,"list-style-type",!0))&&(e=c,b.className===e.className);var e,d,g,f,h,k},I=function(a,b){var c,e;if(c=b.nextSibling,X(a,b,c)){for(;e=c.firstChild;)b.appendChild(e);a.remove(c)}if(c=b.previousSibling,X(a,b,c)){for(;e=c.lastChild;)b.insertBefore(e,b.firstChild);a.remove(c)}},ia=function(a,b,c,e,d){if(b.nodeName!==e||"list-style-type"in d){var g=r(a.selection.getRng(!0));l.each([b].concat(c),function(b){var c=
a.dom;b.nodeName!==e&&(b=c.rename(b,e));H(c,b,d);!0});a.selection.setRng(t(g))}else J(a)},A={toggleList:function(a,b,c){var e=p.getParentList(a),d=p.getSelectedSubLists(a);c=c||{};e&&0<d.length?ia(a,e,d,b,c):e!==a.getBody()&&(e?e.nodeName!==b||"list-style-type"in c?(d=r(a.selection.getRng(!0)),H(a.dom,e,c),I(a.dom,a.dom.rename(e,b)),a.selection.setRng(t(d))):J(a):ha(a,b,c))},removeList:J,mergeWithAdjacentLists:I},Y=function(a,b,c,e){var d=b.startContainer,g=b.startOffset;if(3===d.nodeType&&(c?g<d.data.length:
0<g))return d;b=a.schema.getNonEmptyElements();1===d.nodeType&&(d=N.getNode(d,g));e=new ea(d,e);if(g=c)a=a.dom,g=!!v(d)&&!(!a.isBlock(d.nextSibling)||v(d.previousSibling));for(g&&e.next();d=e[c?"next":"prev2"]();)if("LI"===d.nodeName&&!d.hasChildNodes()||b[d.nodeName]||3===d.nodeType&&0<d.data.length)return d},Z=function(a,b){b=b.childNodes;return 1===b.length&&!n(b[0])&&a.isBlock(b[0])},K=function(a,b,c){var e,d,g=b.parentNode;if(a.isChildOf(b,a.getRoot())&&a.isChildOf(c,a.getRoot())){n(c.lastChild)&&
(d=c.lastChild);g===c.lastChild&&v(g.previousSibling)&&a.remove(g.previousSibling);(e=c.lastChild)&&v(e)&&b.hasChildNodes()&&a.remove(e);q(a,c,!0)&&a.$(c).empty();var f;if(f=Z(a,c)?c.firstChild:c,Z(a,b)&&a.remove(b.firstChild,!0),!q(a,b,!0))for(;e=b.firstChild;)f.appendChild(e);d&&c.appendChild(d);a.remove(b);q(a,g)&&g!==a.getRoot()&&a.remove(g)}},ja=function(a,b){var c,e,d,g=a.dom,f=a.selection,h=f.getStart(),k=p.getClosestListRootElm(a,h);if(h=g.getParent(f.getStart(),"LI",k)){if((c=h.parentNode)===
a.getBody()&&q(g,c))return!0;if(e=E(f.getRng(!0)),(d=g.getParent(Y(a,e,b,k),"LI",k))&&d!==h)return b?(b=a.dom,b.isEmpty(h)?(a.dom.$(h).empty(),K(a.dom,d,h),a.selection.setCursorLocation(h)):(e=r(e),K(b,d,h),a.selection.setRng(t(e)))):(e=r(e),K(a.dom,h,d),d=t(e),a.selection.setRng(d)),!0;if(!d&&!b&&A.removeList(a))return!0}return!1},ka=function(a,b){return ja(a,b)||function(a,b){var d=a.dom,c=a.selection.getStart(),e=p.getClosestListRootElm(a,c),h=d.getParent(c,d.isBlock,e);if(h&&d.isEmpty(h)){var c=
E(a.selection.getRng(!0)),k=d.getParent(Y(a,c,b,e),"LI",e);if(k)return a.undoManager.transact(function(){var c;c=d.getParent(h.parentNode,d.isBlock,e);d.remove(h);c&&d.isEmpty(c)&&d.remove(c);A.mergeWithAdjacentLists(d,k.parentNode);a.selection.select(k,!0);a.selection.collapse(b)}),!0}return!1}(a,b)},L=function(a,b){return a.selection.isCollapsed()?ka(a,b):(e=(c=a).selection.getStart(),d=p.getClosestListRootElm(c,e),!!(c.dom.getParent(e,"LI,DT,DD",d)||0<p.getSelectedListItems(c).length)&&(c.undoManager.transact(function(){c.execCommand("Delete");
F(c.dom,c.getBody())}),!0));var c,e,d},la=function(a){a.on("keydown",function(b){b.keyCode===C.BACKSPACE?L(a,!1)&&b.preventDefault():b.keyCode===C.DELETE&&L(a,!0)&&b.preventDefault()})},ma=function(a){return{backspaceDelete:function(b){L(a,b)}}},B=x.DOM,aa=function(a,b){var c;if(n(a)){for(;c=a.firstChild;)b.appendChild(c);B.remove(a)}},ba=function(a){var b,c,e,d,g=p.getSelectedListItems(a);if(g.length){for(var f=r(a.selection.getRng(!0)),h=0;h<g.length&&(b=g[h],c=void 0,e=void 0,d=void 0,("DT"===
b.nodeName?(B.rename(b,"DD"),1):(c=b.previousSibling)&&n(c)?(c.appendChild(b),1):c&&"LI"===c.nodeName&&n(c.lastChild)?(c.lastChild.appendChild(b),aa(b.lastChild,c.lastChild),1):(c=b.nextSibling)&&n(c)?(c.insertBefore(b,c.firstChild),1):(c=b.previousSibling)&&"LI"===c.nodeName&&(e=B.create(b.parentNode.nodeName),(d=B.getStyle(b.parentNode,"listStyleType"))&&B.setStyle(e,"listStyleType",d),c.appendChild(e),e.appendChild(b),aa(b.lastChild,e),1))||0!==h);h++);return a.selection.setRng(t(f)),a.nodeChanged(),
!0}},M=function(a,b){return function(){var c=a.dom.getParent(a.selection.getStart(),"UL,OL,DL");return c&&c.nodeName===b}},na=function(a){a.on("BeforeExecCommand",function(b){var c,e=b.command.toLowerCase();if("indent"===e?ba(a)&&(c=!0):"outdent"===e&&U(a)&&(c=!0),c)return a.fire("ExecCommand",{command:b.command}),b.preventDefault(),!0});a.addCommand("InsertUnorderedList",function(b,c){A.toggleList(a,"UL",c)});a.addCommand("InsertOrderedList",function(b,c){A.toggleList(a,"OL",c)});a.addCommand("InsertDefinitionList",
function(b,c){A.toggleList(a,"DL",c)});a.addQueryStateHandler("InsertUnorderedList",M(a,"UL"));a.addQueryStateHandler("InsertOrderedList",M(a,"OL"));a.addQueryStateHandler("InsertDefinitionList",M(a,"DL"))},oa=function(a){a.getParam("lists_indent_on_tab",!0)&&a.on("keydown",function(b){b.keyCode!==C.TAB||C.metaKeyPressed(b)||a.dom.getParent(a.selection.getStart(),"LI,DT,DD")&&(b.preventDefault(),b.shiftKey?U(a):ba(a))});la(a)},ca=function(a,b){return function(c){var e=c.control;a.on("NodeChange",
function(a){var c;a:{c=a.parents;for(var d=0;d<c.length;d++){var h=c[d];if(h&&/^(TH|TD)$/.test(h.nodeName)){c=d;break a}}c=-1}a=-1!==c?a.parents.slice(0,c):a.parents;a=l.grep(a,n);e.active(0<a.length&&a[0].nodeName===b)})}},pa=function(a){-1===l.inArray((a.settings.plugins?a.settings.plugins:"").split(/[ ,]/),"advlist")&&(a.addButton("numlist",{active:!1,title:"Numbered list",cmd:"InsertOrderedList",onPostRender:ca(a,"OL")}),a.addButton("bullist",{active:!1,title:"Bullet list",cmd:"InsertUnorderedList",
onPostRender:ca(a,"UL")}));a.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(b){var c=b.control;a.on("nodechange",function(){var b=p.getSelectedListItems(a),d;if(d=0<b.length)b=b[0],d=b.parentNode.firstChild===b;c.disabled(d)})}})};da.add("lists",function(a){return oa(a),pa(a),na(a),ma(a)})}();

var $jscomp={scope:{},findInternal:function(f,m,h){f instanceof String&&(f=String(f));for(var k=f.length,l=0;l<k;l++){var r=f[l];if(m.call(h,r,l,f))return{i:l,v:r}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(f,m,h){if(h.get||h.set)throw new TypeError("ES3 does not support getters and setters.");f!=Array.prototype&&f!=Object.prototype&&(f[m]=h.value)};
$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(f,m,h,k){if(m){h=$jscomp.global;f=f.split(".");for(k=0;k<f.length-1;k++){var l=f[k];l in h||(h[l]={});h=h[l]}f=f[f.length-1];k=h[f];m=m(k);m!=k&&null!=m&&$jscomp.defineProperty(h,f,{configurable:!0,writable:!0,value:m})}};
$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(f,h){return $jscomp.findInternal(this,f,h).v}},"es6-impl","es3");
!function(){var f=tinymce.util.Tools.resolve("tinymce.PluginManager"),m=tinymce.util.Tools.resolve("tinymce.Env"),h=tinymce.util.Tools.resolve("tinymce.util.Tools"),k=function(b){return b.getParam("media_scripts")},l=tinymce.util.Tools.resolve("tinymce.html.SaxParser"),r=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),A=function(b,c){if(b)for(var a=0;a<b.length;a++)if(-1!==c.indexOf(b[a].filter))return b[a]},G=function(b){return function(c){return c?c.style[b].replace(/px$/,""):""}},H=function(b){return function(c,
a){c&&(c.style[b]=/^[0-9.]+$/.test(a)?a+"px":a)}},q={getMaxWidth:G("maxWidth"),getMaxHeight:G("maxHeight"),setMaxWidth:H("maxWidth"),setMaxHeight:H("maxHeight")},v=r.DOM,w=function(b,c){return n=c,f=v.createFragment(n),""!==v.getAttrib(f.firstChild,"data-ephox-embed-iri")?(g=c,t=v.createFragment(g).firstChild,{type:"ephox-embed-iri",source1:v.getAttrib(t,"data-ephox-embed-iri"),source2:"",poster:"",width:q.getMaxWidth(t),height:q.getMaxHeight(t)}):(a=b,e=c,d={},l({validate:!1,allow_conditional_comments:!0,
special:"script,noscript",start:function(b,c){if(d.source1||"param"!==b||(d.source1=c.map.movie),"iframe"!==b&&"object"!==b&&"embed"!==b&&"video"!==b&&"audio"!==b||(d.type||(d.type=b),d=h.extend(c.map,d)),"script"===b){var e=A(a,c.map.src);if(!e)return;d={type:"script",source1:c.map.src,width:e.width,height:e.height}}"source"===b&&(d.source1?d.source2||(d.source2=c.map.src):d.source1=c.map.src);"img"!==b||d.poster||(d.poster=c.map.src)}}).parse(e),d.source1=d.source1||d.src||d.data,d.source2=d.source2||
"",d.poster=d.poster||"",d);var a,e,d,g,t,n,f},I=tinymce.util.Tools.resolve("tinymce.util.Promise"),J=function(b){return{mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"}[b.toLowerCase().split(".").pop()]||""},B=tinymce.util.Tools.resolve("tinymce.html.Writer"),K=tinymce.util.Tools.resolve("tinymce.html.Schema"),C=r.DOM,p=function(b,c){var a,e,d,g;for(a in c)if(d=""+c[a],b.map[a])for(e=b.length;e--;)(g=b[e]).name===a&&(d?(b.map[a]=
d,g.value=d):(delete b.map[a],b.splice(e,1)));else d&&(b.push({name:a,value:d}),b.map[a]=d)},T=function(b,c){var a,e;b=C.createFragment(b).firstChild;return q.setMaxWidth(b,c.width),q.setMaxHeight(b,c.height),a=b.outerHTML,e=B(),l(e).parse(a),e.getContent()},x=function(b,c,a){return h=b,k=C.createFragment(h),""!==C.getAttrib(k.firstChild,"data-ephox-embed-iri")?T(b,c):(e=b,d=c,g=a,n=B(),f=0,l({validate:!1,allow_conditional_comments:!0,special:"script,noscript",comment:function(a){n.comment(a)},cdata:function(a){n.cdata(a)},
text:function(a,b){n.text(a,b)},start:function(a,b,c){switch(a){case "video":case "object":case "embed":case "img":case "iframe":void 0!==d.height&&void 0!==d.width&&p(b,{width:d.width,height:d.height})}if(g)switch(a){case "video":p(b,{poster:d.poster,src:""});d.source2&&p(b,{src:""});break;case "iframe":p(b,{src:d.source1});break;case "source":if(2>=++f&&(p(b,{src:d["source"+f],type:d["source"+f+"mime"]}),!d["source"+f]))return;break;case "img":if(!d.poster)return;t=!0}n.start(a,b,c)},end:function(a){if("video"===
a&&g)for(var b=1;2>=b;b++)if(d["source"+b]){var c=[];c.map={};f<b&&(p(c,{src:d["source"+b],type:d["source"+b+"mime"]}),n.start("source",c,!0))}d.poster&&"object"===a&&g&&!t&&(b=[],b.map={},p(b,{src:d.poster,width:d.width,height:d.height}),n.start("img",b,!0));n.end(a)}},K({})).parse(e),n.getContent());var e,d,g,t,n,f,h,k},U=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",
allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",
w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],V=function(b,c){var a=h.extend({},c);if(!a.source1&&(h.extend(a,w(k(b),a.embed)),!a.source1))return"";if(a.source2||(a.source2=""),a.poster||(a.poster=""),a.source1=b.convertURL(a.source1,
"source"),a.source2=b.convertURL(a.source2,"source"),a.source1mime=J(a.source1),a.source2mime=J(a.source2),a.poster=b.convertURL(a.poster,"poster"),h.each(U,function(b){var c,d,e=b.regex.exec(a.source1);if(e){d=b.url;for(c=0;e[c];c++)d=d.replace("$"+c,function(){return e[c]});a.source1=d;a.type=b.type;a.allowFullscreen=b.allowFullscreen;a.width=a.width||b.w;a.height=a.height||b.h}}),a.embed)return x(a.embed,a,!0);(c=A(k(b),a.source1))&&(a.type="script",a.width=c.width,a.height=c.height);var e,d;c=
b.getParam("audio_template_callback");var g=b.getParam("video_template_callback");return a.width=a.width||300,a.height=a.height||150,h.each(a,function(c,d){a[d]=b.dom.encode(c)}),"iframe"===a.type?(d=a.allowFullscreen?' allowFullscreen="1"':"",'<iframe src="'+a.source1+'" width="'+a.width+'" height="'+a.height+'"'+d+"></iframe>"):"application/x-shockwave-flash"===a.source1mime?(e='<object data="'+a.source1+'" width="'+a.width+'" height="'+a.height+'" type="application/x-shockwave-flash">',a.poster&&
(e+='<img src="'+a.poster+'" width="'+a.width+'" height="'+a.height+'" />'),e+="</object>"):-1!==a.source1mime.indexOf("audio")?c?c(a):'<audio controls="controls" src="'+a.source1+'">'+(a.source2?'\n<source src="'+a.source2+'"'+(a.source2mime?' type="'+a.source2mime+'"':"")+" />\n":"")+"</audio>":"script"===a.type?'<script src="'+a.source1+'">\x3c/script>':g?g(a):'<video width="'+a.width+'" height="'+a.height+'"'+(a.poster?' poster="'+a.poster+'"':"")+' controls="controls">\n<source src="'+a.source1+
'"'+(a.source1mime?' type="'+a.source1mime+'"':"")+" />\n"+(a.source2?'<source src="'+a.source2+'"'+(a.source2mime?' type="'+a.source2mime+'"':"")+" />\n":"")+"</video>"},y={},L=function(b){return function(c){return V(b,c)}},D=function(b,c){var a,e,d=b.getParam("media_url_resolver");return d?(e=L(b),new I(function(b,a){var g=function(a){return a.html&&(y[c.source1]=a),b({url:c.source1,html:a.html?a.html:e(c)})};y[c.source1]?g(y[c.source1]):d({url:c.source1},g,a)})):(a=L(b),new I(function(b){b({html:a(c),
url:c.source1})}))},M=function(b,c){b.state.set("oldVal",b.value());c.state.set("oldVal",c.value())},z=function(b,c){var a=b.find("#width")[0],e=b.find("#height")[0];b=b.find("#constrain")[0];a&&e&&b&&c(a,e,b.checked())},E=function(b,c,a){var e=b.state.get("oldVal"),d=c.state.get("oldVal"),g=b.value(),f=c.value();a&&e&&d&&g&&f&&(g!==e?(f=Math.round(g/e*f),isNaN(f)||c.value(f)):(g=Math.round(f/d*g),isNaN(g)||b.value(g)));M(b,c)},W=function(b){var c=function(){b(function(a){z(a,E)})};return{type:"container",
label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:c,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:c,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}},X=m.ie&&8>=m.ie?"onChange":"onInput",F=function(b){return function(c){b.notificationManager.open({type:"error",text:c&&c.msg?"Media embed handler error: "+c.msg:"Media embed handler threw unknown error."})}},
N=function(b,c){return function(a){var e=a.html,d=b.find("#embed")[0];a=h.extend(w(k(c),e),{source1:a.url});b.fromJSON(a);d&&(d.value(e),z(b,E))}},O=function(b,c){var a=b.dom.select("img[data-mce-object]");b.insertContent(c);var e,d=b.dom.select("img[data-mce-object]");for(c=0;c<a.length;c++)for(e=d.length-1;0<=e;e--)a[c]===d[e]&&d.splice(e,1);b.selection.select(d[0]);b.nodeChanged()},P=function(b){var c,a,e,d,g=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source",
onpaste:function(){setTimeout(function(){D(b,c.toJSON()).then(N(c,b))["catch"](F(b))},1)},onchange:function(a){var d;D(b,c.toJSON()).then(N(c,b))["catch"](F(b));d=c;h.each(a.meta,function(a,b){d.find("#"+b).value(a)})},onbeforecall:function(a){a.meta=c.toJSON()}}],f=[];if(b.getParam("media_alt_source",!0)&&f.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"}),b.getParam("media_poster",!0)&&f.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"}),
b.getParam("media_dimensions",!0))e=W(function(b){b(c);a=c.toJSON();c.find("#embed").value(x(a.embed,a))}),g.push(e);e=b.selection.getNode();a=(d=e.getAttribute("data-ephox-embed-iri"))?{source1:d,"data-ephox-embed-iri":d,width:q.getMaxWidth(e),height:q.getMaxHeight(e)}:e.getAttribute("data-mce-object")?w(k(b),b.serializer.serialize(e,{selection:!0})):{};e={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:function(a){var b=a.selection.getNode();if(b.getAttribute("data-mce-object")||b.getAttribute("data-ephox-embed-iri"))return a.selection.getContent()}(b),
multiline:!0,rows:5,label:"Source"};e[X]=function(){a=h.extend({},w(k(b),this.value()));this.parent().parent().fromJSON(a)};g=[{title:"General",type:"form",items:g},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},e]}];0<f.length&&g.push({title:"Advanced",type:"form",items:f});c=b.windowManager.open({title:"Insert/edit media",data:a,bodyType:"tabpanel",body:g,onSubmit:function(){var a;
z(c,E);(a=c.toJSON()).embed=x(a.embed,a);a.embed&&y.hasOwnProperty(a.source1)?O(b,a.embed):D(b,a).then(function(a){O(b,a.html)})["catch"](F(b))}});z(c,M)},Y=function(b){return{showDialog:function(){P(b)}}},Z=function(b){b.addCommand("mceMedia",function(){P(b)})},u=tinymce.util.Tools.resolve("tinymce.html.Node"),Q=function(b,c){if(!1===b.getParam("media_filter_html",!0))return c;var a,e=B();return l({validate:!1,allow_conditional_comments:!1,special:"script,noscript",comment:function(a){e.comment(a)},
cdata:function(a){e.cdata(a)},text:function(a,b){e.text(a,b)},start:function(c,g,f){if(a=!0,"script"!==c&&"noscript"!==c){for(var d=0;d<g.length;d++){if(0===g[d].name.indexOf("on"))return;"style"===g[d].name&&(g[d].value=b.dom.serializeStyle(b.dom.parseStyle(g[d].value),c))}e.start(c,g,f);a=!1}},end:function(b){a||e.end(b)}},K({})).parse(c),e.getContent()},aa=function(b,c){var a,e=c.name;return(a=new u("img",1)).shortEnded=!0,R(b,c,a),a.attr({width:c.attr("width")||"300",height:c.attr("height")||
("audio"===e?"30":"150"),style:c.attr("style"),src:m.transparentSrc,"data-mce-object":e,"class":"mce-object mce-object-"+e}),a},ba=function(b,c){var a,e,d,g=c.name;return(a=new u("span",1)).attr({contentEditable:"false",style:c.attr("style"),"data-mce-object":g,"class":"mce-preview-object mce-object-"+g}),R(b,c,a),(e=new u(g,1)).attr({src:c.attr("src"),allowfullscreen:c.attr("allowfullscreen"),style:c.attr("style"),"class":c.attr("class"),width:c.attr("width"),height:c.attr("height"),frameborder:"0"}),
(d=new u("span",1)).attr("class","mce-shim"),a.append(e),a.append(d),a},R=function(b,c,a){var e,d,g,f,h;for(f=(g=c.attributes).length;f--;)e=g[f].name,d=g[f].value,"width"!==e&&"height"!==e&&"style"!==e&&("data"!==e&&"src"!==e||(d=b.convertURL(d,e)),a.attr("data-mce-p-"+e,d));(h=c.firstChild&&c.firstChild.value)&&(a.attr("data-mce-html",escape(Q(b,h))),a.firstChild=null)},S=function(b){for(;b=b.parent;)if(b.attr("data-ephox-embed-iri"))return!0;return!1},ca=function(b){return function(c){for(var a,
e,d=c.length;d--;)(a=c[d]).parent&&(a.parent.attr("data-mce-object")||("script"!==a.name||(e=A(k(b),a.attr("src"))))&&(e&&(e.width&&a.attr("width",e.width.toString()),e.height&&a.attr("height",e.height.toString())),"iframe"===a.name&&b.getParam("media_live_embeds",!0)&&m.ceFalse?S(a)||a.replace(ba(b,a)):S(a)||a.replace(aa(b,a))))}},da=function(b){b.on("preInit",function(){var c=b.schema.getSpecialElements();h.each(["video","audio","iframe","object"],function(a){c[a]=new RegExp("</"+a+"[^>]*>","gi")});
var a=b.schema.getBoolAttrs();h.each(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"],function(b){a[b]={}});b.parser.addNodeFilter("iframe,video,audio,object,embed,script",ca(b));b.serializer.addAttributeFilter("data-mce-object",function(a,c){for(var d,e,f,h,k,m,l,p,q=a.length;q--;)if((d=a[q]).parent){l=d.attr(c);e=new u(l,1);"audio"!==l&&"script"!==l&&((p=d.attr("class"))&&-1!==p.indexOf("mce-preview-object")?e.attr({width:d.firstChild.attr("width"),height:d.firstChild.attr("height")}):
e.attr({width:d.attr("width"),height:d.attr("height")}));e.attr({style:d.attr("style")});for(f=(h=d.attributes).length;f--;){var r=h[f].name;0===r.indexOf("data-mce-p-")&&e.attr(r.substr(11),h[f].value)}"script"===l&&e.attr("type","text/javascript");(k=d.attr("data-mce-html"))&&((m=new u("#text",3)).raw=!0,m.value=Q(b,unescape(k)),e.append(m));d.replace(e)}})});b.on("setContent",function(){b.$("span.mce-preview-object").each(function(c,a){c=b.$(a);0===c.find("span.mce-shim",a).length&&c.append('<span class="mce-shim"></span>')})})},
ea=function(b){b.on("ResolveName",function(b){var a;1===b.target.nodeType&&(a=b.target.getAttribute("data-mce-object"))&&(b.name=a)})},fa=function(b){b.on("click keyup",function(){var c=b.selection.getNode();c&&b.dom.hasClass(c,"mce-preview-object")&&b.dom.getAttrib(c,"data-mce-selected")&&c.setAttribute("data-mce-selected","2")});b.on("ObjectSelected",function(b){var a=b.target.getAttribute("data-mce-object");"audio"!==a&&"script"!==a||b.preventDefault()});b.on("objectResized",function(b){var a,
c=b.target;c.getAttribute("data-mce-object")&&(a=c.getAttribute("data-mce-html"))&&(a=unescape(a),c.setAttribute("data-mce-html",escape(x(a,{width:b.width,height:b.height}))))})};f.add("media",function(b){Z(b);b.addButton("media",{tooltip:"Insert/edit media",cmd:"mceMedia",stateSelector:["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"]});b.addMenuItem("media",{icon:"media",text:"Media",cmd:"mceMedia",context:"insert",prependToContext:!0});return ea(b),da(b),fa(b),Y(b)})}();

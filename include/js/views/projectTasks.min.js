function taskFormHandler(){this.forms=[];this.views=[]}taskFormHandler.prototype.bindViews=function(){for(var a=this.forms,c=this.views,b=0;b<a.length;b++)a[b].onsubmit=function(a){var b=a.currentTarget.dataset.index;a.preventDefault();a.stopPropagation();handleForm(a,c[b])}};
var handleForm=function(a,c){var b=a.currentTarget,e=b.action,d=validateCompleteForm(b);a.stopPropagation();a.preventDefault();if(1==d){a="";for(d=0;d<b.elements.length;d++){var f=b.elements[d];if(void 0!=f.attributes.multiple){for(var h="",k=0;k<f.options.length;k++){var l=f.options[k];l.selected&&(h+="&"+f.name+"="+encodeURIComponent(l.value))}""!=h&&(a+=h)}else void 0!=f.value&&(a+="&"+f.name+"="+encodeURIComponent(f.value))}var g=new ajaxRequest(e,"",function(){var a=g.request.responseText;"ok"==
a?(c.update(),systemMessage.added(c.$get("itemType")),a=b.dataset.tasklist,blindtoggle("form_"+a),toggleClass("add_butn_"+a,"butn_link_active","butn_link"),toggleClass("sm_"+a,"smooth","nosmooth"),b.reset()):console.log(a)});g.requestType="POST";g.postBody=a;g.sendRequest()}};
function handleStatus(a,c){var b=a.target;a=b.dataset.viewindex;var e=b.dataset.task,b=b.dataset.project,d;"open"==c?d="managetask.php?action=open&tid="+e+"id="+b:"close"==c&&(d="managetask.php?action=close&tid="+e+"id="+b);closeElement("task_"+e,d,projectTaskViews[a])}function handleDelete(a){a=a.target;var c=a.dataset.task;confirmDelete(a.dataset.confirmtext,"task_"+c,"managetask.php?action=del&tid="+c+"id="+a.dataset.project,projectTaskViews[a.dataset.viewindex])}
function initTasklistViews(){var a=new taskFormHandler,c=cssAll(".blockaccordion_content");projectTaskViews=[];accordeons=[];for(var b=0;b<c.length;b++){var e=createView({el:c[b].id,itemType:"task",url:"managetask.php?action=projectTasks&tlid="+c[b].dataset.tasklist+"&id="+c[b].dataset.project,dependencies:[]});e.afterUpdate(function(){for(var a=cssAll(".taskList"),b=0;b<a.length;b++)accordeons.push(new accordion2(a[b].id));a=cssAll(".closeElement");for(b=0;b<a.length;b++)a[b].onclick=function(a){handleStatus(a,
"close")};a=cssAll(".openElement");for(b=0;b<a.length;b++)a[b].onclick=function(a){handleStatus(a,"open")};a=cssAll(".deleteElement");for(b=0;b<a.length;b++)a[b].onclick=function(a){handleDelete(a)}});projectTaskViews.push(e)}a.forms=document.getElementsByClassName("taskSubmitForm");a.views=projectTaskViews;a.bindViews()}var accord_dashboard=new accordion2("blockTasks",{classNames:{toggle:"win_none",toggleActive:"win_block",content:"blockaccordion_content"}});
function activateAccordeon(a){accord_dashboard.toggle(cssAll("#blockTasks .blockaccordion_content")[a]);setCookie("activeSlideProjectTasks",a)}window.addEventListener("load",function(){for(var a=cssAll("#blockTasks > div[class~='headline'] > a"),c=0;c<a.length;c++){var b=a[c].getAttribute("onclick"),b=b+("activateAccordeon("+c+");");a[c].setAttribute("onclick",b)}activateAccordeon(0);initTinyMce()});window.addEventListener("load",initTasklistViews());

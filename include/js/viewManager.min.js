function createView(a){var b={items:[],pages:[],additionalData:[],limit:pagination.itemsPerPage,offset:0,sortBy:a.sortBy||"",sortDirection:a.sortDirection||"ASC",currentPage:1,itemsCount:0,itemType:a.itemType,url:a.url,dependencies:a.dependencies},c=new Vue({el:"#"+a.el,data:b,methods:{update:function(a){updateView(this,a)},afterUpdate:function(a){this.$on("iloaded",function(){Vue.nextTick(a)})},afterLoad:function(a){this.$once("iloaded",function(){Vue.nextTick(a)})}}}),d=a.url;a.sortBy&&(d+="&sortBy="+
a.sortBy);a.sortDirection&&(d+="&sortDirection="+a.sortDirection);var e=new ajaxRequest(d,a.el,function(){var a=JSON.parse(e.request.responseText);b.items=a.items;b.itemsCount=a.count;void 0!=a.additionalData&&(b.additionalData=a.additionalData);a=pagination.listPages(a.count);b.pages=a;c.$emit("iloaded")});e.sendRequest();return c}
function updateView(a,b){void 0===b&&(b=!0);var c=a.url;0<a.limit&&(c+="&limit="+a.limit);0<a.offset&&(c+="&offset="+a.offset);a.sortBy&&(c+="&sortBy="+a.sortBy);a.sortDirection&&(c+="&sortDirection="+a.sortDirection);var d=new ajaxRequest(c,a.$el.id,function(){var c=JSON.parse(d.request.responseText);Vue.set(a,"items",c.items);void 0!=c.additionalData&&Vue.set(a,"additionalData",c.additionalData);Vue.set(a,"pages",pagination.listPages(c.count));a.$emit("iloaded");if(1==b&&(c=a.$get("dependencies"),
0<c.length))for(var f=0;f<c.length;f++)Vue.set(c[f],"limit",a.limit),Vue.set(c[f],"offset",a.offset),updateView(c[f],!0)});d.sendRequest()}function sortView(a,b,c){a.sortBy=b;a.sortDirection="ASC"==a.sortDirection?"DESC":"ASC";a.update(!0)}
var pagination={itemsPerPage:15,listPages:function(a){a=Math.ceil(a/this.itemsPerPage);for(var b=[],c=0;c<a;c++){var d=c+1;b.push({index:d,limit:d*this.itemsPerPage})}return b},loadPage:function(a,b){var c=b*this.itemsPerPage-this.itemsPerPage;Vue.set(a,"limit",this.itemsPerPage);Vue.set(a,"offset",c);Vue.set(a,"currentPage",b);a.update(!0)},loadNextPage:function(a){var b=a.$get("currentPage"),c=Math.ceil(a.$get("itemsCount")/this.itemsPerPage),b=b+1;b>c&&(b=c);this.loadPage(a,b)},loadPrevPage:function(a){var b=
a.$get("currentPage")-1;1>b&&(b=1);this.loadPage(a,b)},limitPagesDisplayed:function(a,b){return 1==a.index||2==a.index||a.index==b.length/2||currentPage==a.index||a.index==b.length-1||a.index==b.length}};
function submitForm(a){var b=a.currentTarget,c=b.action,d=validateCompleteForm(b);a.stopPropagation();a.preventDefault();if(1==d){a="";for(d=0;d<b.elements.length;d++){var e=b.elements[d];if(void 0!=e.attributes.multiple){for(var f="",h=0;h<e.options.length;h++){var k=e.options[h];k.selected&&(f+="&"+e.name+"="+encodeURIComponent(k.value))}""!=f&&(a+=f)}else void 0!=e.value&&(a+="&"+e.name+"="+encodeURIComponent(e.value))}var g=new ajaxRequest(c,"",function(){var a=g.request.responseText;if("ok"==
a){formView.update(formView.doUpdate?!0:!1);systemMessage.added(formView.$get("itemType"));try{formSubmited()}catch(l){}}else console.log(a)});g.requestType="POST";g.postBody=a;g.sendRequest()}}function startWait(a){cssId(a).style.display="block"}function stopWait(a){cssId(a).style.display="none"}closeEndcolor="#377814";deleteEndcolor="#c62424";function confirmDelete(a,b,c,d){1==confirm(a)&&deleteElement(b,c,d)}
function deleteElement(a,b,c){var d=new ajaxRequest(b,"",function(){"ok"==d.request.responseText?(removeRow(a,deleteEndcolor),void 0!=c&&(c.update(),systemMessage.deleted(c.$get("itemType")))):console.log(d.request.responseText)});d.sendRequest()}function closeElement(a,b,c){var d=new ajaxRequest(b,"",function(){"ok"==d.request.responseText&&(removeRow(a,closeEndcolor),void 0!=c&&(c.update(),systemMessage.closed(c.$get("itemType"))))});d.sendRequest()}
function removeRow(a,b){var c=cssId(a);null!=c&&(c.style.backgroundColor="#FFFFFF",Velocity(c,{backgroundColor:b,backgroundColorAlpha:.6,colorAlpha:.6},{complete:function(){Velocity(c,"fadeOut",{delay:1500,duration:2500})}}))}Vue.filter("truncate",function(a,b){return a.length>=b?a.substr(0,b)+"...":a});
